---
- name: Generate tls dir
  file:
    path: "{{ consul_local_tls_dir }}"
    state: directory
    mode: 0750
  delegate_to: localhost
  run_once: true
  become: no

- name: Generate root certificate for dc
  shell: openssl req \
    -newkey rsa:4096 \
    -nodes -x509 -days 3650 \
    -subj "{{ consul_root_cert_subj }}" \
    -out {{ consul_local_tls_dir }}/consul-root.cer \
    -keyout {{ consul_local_tls_dir }}/consul-root-key.pem
  args:
    executable: /bin/bash
    chdir: "{{ consul_local_tls_dir }}"
    creates: "{{ consul_local_tls_dir }}/consul-root.cer"
  delegate_to: localhost
  run_once: true
  become: no
